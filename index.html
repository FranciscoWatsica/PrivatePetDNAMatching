<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Pet DNA Matching System</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            font-size: 1.2em;
            color: #7f8c8d;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ee5a6f;
            box-shadow: 0 0 0 3px rgba(238, 90, 111, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #ee5a6f 0%, #f79c42 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(238, 90, 111, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #00d2d3 0%, #01a3a4 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }

        .wallet-info {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .pet-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pet-card {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .pet-card:hover {
            border-color: #ee5a6f;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(238, 90, 111, 0.2);
        }

        .pet-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .pet-card p {
            color: #7f8c8d;
            margin: 5px 0;
        }

        .pet-card .pet-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .pet-card .btn {
            padding: 8px 15px;
            font-size: 14px;
        }

        .dna-markers {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .marker {
            background: #fff5f5;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #ee5a6f;
        }

        .marker label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ee5a6f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        code {
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .match-result {
            background: linear-gradient(135deg, #00d2d3 0%, #01a3a4 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
        }

        .match-result h3 {
            margin-bottom: 15px;
        }

        .compatibility-score {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .pet-list {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2em;
                flex-direction: column;
            }

            .dna-markers {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                üß¨ Private Pet DNA Matching System
            </h1>
            <p>FHE-powered pet breeding platform that finds optimal breeding partners while protecting genetic privacy and preventing hereditary diseases</p>
        </div>

        <div id="walletSection" class="card">
            <h2>üîó Wallet Connection</h2>
            <div id="contractInfo" class="status info">
                <strong>üìù Contract Deployment Guide:</strong> Currently using demo address. For full functionality:<br>
                1. Deploy <code>contracts/PrivatePetDNAMatching.sol</code> to Sepolia testnet<br>
                2. Replace <code>CONTRACT_ADDRESS</code> in JavaScript with real contract address<br>
                3. Obtain Sepolia testnet ETH for transactions
            </div>
            <button id="connectWallet" class="btn">
                Connect MetaMask Wallet
            </button>
            <div id="walletInfo" class="wallet-info hidden">
                <p><strong>Address:</strong> <span id="walletAddress"></span></p>
                <p><strong>Balance:</strong> <span id="walletBalance"></span> ETH</p>
            </div>
        </div>

        <div id="registerSection" class="card">
            <h2>üêï Pet Registration</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="petName">Pet Name</label>
                    <input type="text" id="petName" placeholder="Enter pet name">
                </div>
                <div class="form-group">
                    <label for="petBreed">Breed</label>
                    <select id="petBreed">
                        <option value="">Select breed</option>
                        <option value="Golden Retriever">Golden Retriever</option>
                        <option value="Labrador Retriever">Labrador Retriever</option>
                        <option value="German Shepherd">German Shepherd</option>
                        <option value="Border Collie">Border Collie</option>
                        <option value="Poodle">Poodle</option>
                        <option value="Samoyed">Samoyed</option>
                        <option value="Siberian Husky">Siberian Husky</option>
                        <option value="Bichon Frise">Bichon Frise</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="petAge">Age</label>
                    <input type="number" id="petAge" min="1" max="20" placeholder="Age in years">
                </div>
            </div>

            <div class="dna-markers">
                <div class="marker">
                    <label for="marker1">Genetic Marker 1 (0-255)</label>
                    <input type="number" id="marker1" min="0" max="255" placeholder="Marker 1 value">
                </div>
                <div class="marker">
                    <label for="marker2">Genetic Marker 2 (0-255)</label>
                    <input type="number" id="marker2" min="0" max="255" placeholder="Marker 2 value">
                </div>
                <div class="marker">
                    <label for="marker3">Genetic Marker 3 (0-255)</label>
                    <input type="number" id="marker3" min="0" max="255" placeholder="Marker 3 value">
                </div>
                <div class="marker">
                    <label for="marker4">Genetic Marker 4 (0-255)</label>
                    <input type="number" id="marker4" min="0" max="255" placeholder="Marker 4 value">
                </div>
                <div class="marker">
                    <label for="healthRisk">Health Risk Score (0-255, lower is better)</label>
                    <input type="number" id="healthRisk" min="0" max="255" placeholder="Health risk score">
                </div>
                <button id="randomDNA" class="btn btn-secondary" style="margin-top: 10px;">
                    üé≤ Generate Random DNA
                </button>
            </div>

            <button id="registerPet" class="btn" style="margin-top: 20px;">
                Register Pet
            </button>
        </div>

        <div id="myPetsSection" class="card">
            <h2>üè† My Pets</h2>
            <button id="loadMyPets" class="btn btn-secondary">
                Load My Pets
            </button>
            <div id="myPetsList" class="pet-list"></div>
        </div>

        <div id="matchingSection" class="card">
            <h2>üíï Matching Service</h2>
            <div class="form-group">
                <label for="matchPetSelect">Select pet to match</label>
                <select id="matchPetSelect">
                    <option value="">Please load your pets first</option>
                </select>
            </div>
            <button id="requestMatching" class="btn btn-success">
                Start Matching
            </button>
            <div id="matchingResults"></div>
        </div>

        <div id="availablePetsSection" class="card">
            <h2>üêæ Available Pets</h2>
            <button id="loadAvailablePets" class="btn btn-secondary">
                View Available Pets
            </button>
            <div id="availablePetsList" class="pet-list"></div>
        </div>

        <div id="status"></div>
    </div>

    <script>
        // ÂêàÁ∫¶Âú∞ÂùÄÂíåABI (ÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖÈÉ®ÁΩ≤Êõ¥Êñ∞)
        // ÊºîÁ§∫Âú∞ÂùÄ - ËØ∑ÊõøÊç¢‰∏∫ÂÆûÈôÖÈÉ®ÁΩ≤ÁöÑÂêàÁ∫¶Âú∞ÂùÄ
        const CONTRACT_ADDRESS = "0x1234567890123456789012345678901234567890";
        const CONTRACT_ABI = [
            "function registerPet(string memory _name, string memory _breed, uint8 _age, uint8 _marker1, uint8 _marker2, uint8 _marker3, uint8 _marker4, uint8 _healthRisk) external returns (uint256 petId)",
            "function requestMatching(uint256 _petId) external returns (uint256 requestId)",
            "function toggleBreedingStatus(uint256 _petId) external",
            "function getPetInfo(uint256 _petId) external view returns (address petOwner, string memory name, string memory breed, uint8 age, bool isAvailableForBreeding, uint256 registrationTime)",
            "function getMatchingRequest(uint256 _requestId) external view returns (uint256 petId, address requester, bool isActive, uint256 requestTime, uint256 bestMatchId, uint256 potentialMatchCount)",
            "function getOwnerPets(address _owner) external view returns (uint256[] memory)",
            "function getTotalPets() external view returns (uint256)",
            "function getAvailablePets() external view returns (uint256[] memory)",
            "event PetRegistered(uint256 indexed petId, address indexed owner, string name, string breed)",
            "event MatchingRequested(uint256 indexed requestId, uint256 indexed petId, address indexed requester)",
            "event MatchFound(uint256 indexed requestId, uint256 indexed petId, uint256 indexed matchId, uint32 compatibility)",
            "event NoSuitableMatch(uint256 indexed requestId, uint256 indexed petId)",
            "event PetBreedingStatusChanged(uint256 indexed petId, bool isAvailable)"
        ];

        let provider;
        let signer;
        let contract;
        let userAccount;

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            bindEventListeners();
        });

        async function initializeApp() {
            // Check if Ethers.js is loaded
            if (typeof ethers === 'undefined') {
                showStatus('Loading Ethers.js library...', 'info');
                // Try to reload ethers
                setTimeout(() => {
                    if (typeof ethers === 'undefined') {
                        showStatus('Ethers.js loading failed, please refresh the page', 'error');
                        return;
                    }
                    initializeApp();
                }, 1000);
                return;
            }

            // Check if MetaMask is installed
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Create provider
                    provider = new ethers.providers.Web3Provider(window.ethereum);

                    // Listen for account changes
                    window.ethereum.on('accountsChanged', handleAccountsChanged);
                    window.ethereum.on('chainChanged', handleChainChanged);

                    showStatus('MetaMask detected, please connect wallet to begin', 'info');
                } catch (error) {
                    console.error('Initialization error:', error);
                    showStatus('Initialization failed: ' + error.message, 'error');
                }
            } else {
                showStatus('Please install MetaMask wallet', 'error');
            }
        }

        function bindEventListeners() {
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
            document.getElementById('registerPet').addEventListener('click', registerPet);
            document.getElementById('loadMyPets').addEventListener('click', loadMyPets);
            document.getElementById('requestMatching').addEventListener('click', requestMatching);
            document.getElementById('loadAvailablePets').addEventListener('click', loadAvailablePets);
            document.getElementById('randomDNA').addEventListener('click', generateRandomDNA);
        }

        async function connectWallet() {
            try {
                showLoading('connectWallet', true);

                // Request user authorization
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                if (accounts.length > 0) {
                    userAccount = accounts[0];
                    signer = provider.getSigner();

                    // Check contract address
                    if (CONTRACT_ADDRESS === "YOUR_CONTRACT_ADDRESS_HERE") {
                        showStatus('Warning: Contract address not configured, please deploy contract first', 'info');
                    } else if (CONTRACT_ADDRESS === "0x1234567890123456789012345678901234567890") {
                        showStatus('Note: Currently using demo contract address, real functionality requires deploying actual contract', 'info');
                        // Still create contract instance for demo purposes, but will prompt user when calling
                        try {
                            contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                        } catch (error) {
                            showStatus('Contract connection failed, please check network and address', 'error');
                        }
                    } else {
                        // Create contract instance
                        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    }

                    // Get balance
                    const balance = await provider.getBalance(userAccount);

                    // Update UI
                    document.getElementById('walletAddress').textContent =
                        userAccount.substring(0, 6) + '...' + userAccount.substring(38);
                    document.getElementById('walletBalance').textContent =
                        ethers.utils.formatEther(balance);

                    document.getElementById('walletInfo').classList.remove('hidden');

                    showStatus('Wallet connected successfully!', 'success');
                }
            } catch (error) {
                console.error('Wallet connection failed:', error);
                showStatus('Wallet connection failed: ' + error.message, 'error');
            } finally {
                showLoading('connectWallet', false);
            }
        }

        async function registerPet() {
            if (!contract) {
                showStatus('Please connect wallet first', 'error');
                return;
            }

            // Check if contract address is valid
            if (CONTRACT_ADDRESS === "YOUR_CONTRACT_ADDRESS_HERE") {
                showStatus('Please deploy contract and update contract address first', 'error');
                return;
            }

            // Demo mode notice
            if (CONTRACT_ADDRESS === "0x1234567890123456789012345678901234567890") {
                showStatus('Demo mode: This is a mock contract address, actual transactions will fail', 'info');
            }

            try {
                showLoading('registerPet', true);

                const name = document.getElementById('petName').value.trim();
                const breed = document.getElementById('petBreed').value;
                const age = parseInt(document.getElementById('petAge').value);
                const marker1 = parseInt(document.getElementById('marker1').value);
                const marker2 = parseInt(document.getElementById('marker2').value);
                const marker3 = parseInt(document.getElementById('marker3').value);
                const marker4 = parseInt(document.getElementById('marker4').value);
                const healthRisk = parseInt(document.getElementById('healthRisk').value);

                // Validate input
                if (!name) {
                    throw new Error('Please enter pet name');
                }
                if (!breed) {
                    throw new Error('Please select pet breed');
                }
                if (!age || age <= 0 || age > 20) {
                    throw new Error('Please enter valid pet age (1-20 years)');
                }
                if (isNaN(marker1) || marker1 < 0 || marker1 > 255) {
                    throw new Error('Genetic marker 1 must be a value between 0-255');
                }
                if (isNaN(marker2) || marker2 < 0 || marker2 > 255) {
                    throw new Error('Genetic marker 2 must be a value between 0-255');
                }
                if (isNaN(marker3) || marker3 < 0 || marker3 > 255) {
                    throw new Error('Genetic marker 3 must be a value between 0-255');
                }
                if (isNaN(marker4) || marker4 < 0 || marker4 > 255) {
                    throw new Error('Genetic marker 4 must be a value between 0-255');
                }
                if (isNaN(healthRisk) || healthRisk < 0 || healthRisk > 255) {
                    throw new Error('Health risk score must be a value between 0-255');
                }

                // Call contract to register pet
                const tx = await contract.registerPet(
                    name, breed, age, marker1, marker2, marker3, marker4, healthRisk
                );

                showStatus('Transaction sent, waiting for confirmation...', 'info');

                const receipt = await tx.wait();

                // Clear form
                clearRegistrationForm();

                showStatus(`Pet registration successful! Transaction hash: ${receipt.transactionHash}`, 'success');

                // Auto-load my pets
                setTimeout(() => loadMyPets(), 2000);

            } catch (error) {
                console.error('Pet registration failed:', error);
                showStatus('Pet registration failed: ' + (error.reason || error.message), 'error');
            } finally {
                showLoading('registerPet', false);
            }
        }

        async function loadMyPets() {
            if (!contract) {
                showStatus('Please connect wallet first', 'error');
                return;
            }

            try {
                showLoading('loadMyPets', true);

                // Get user's pet ID list
                const petIds = await contract.getOwnerPets(userAccount);

                const myPetsList = document.getElementById('myPetsList');
                const matchPetSelect = document.getElementById('matchPetSelect');

                myPetsList.innerHTML = '';
                matchPetSelect.innerHTML = '<option value="">Select pet to match</option>';

                if (petIds.length === 0) {
                    myPetsList.innerHTML = '<p>You haven\'t registered any pets yet</p>';
                    return;
                }

                // Get detailed information for each pet
                for (let i = 0; i < petIds.length; i++) {
                    const petId = petIds[i];
                    const petInfo = await contract.getPetInfo(petId);

                    const petCard = createPetCard(petId, petInfo);
                    myPetsList.appendChild(petCard);

                    // Add to matching dropdown options
                    const option = document.createElement('option');
                    option.value = petId.toString();
                    option.textContent = `${petInfo.name} (${petInfo.breed})`;
                    matchPetSelect.appendChild(option);
                }

                showStatus(`Successfully loaded ${petIds.length} pets`, 'success');

            } catch (error) {
                console.error('Loading pets failed:', error);
                showStatus('Loading pets failed: ' + error.message, 'error');
            } finally {
                showLoading('loadMyPets', false);
            }
        }

        async function requestMatching() {
            if (!contract) {
                showStatus('Please connect wallet first', 'error');
                return;
            }

            const petId = document.getElementById('matchPetSelect').value;
            if (!petId) {
                showStatus('Please select a pet to match', 'error');
                return;
            }

            try {
                showLoading('requestMatching', true);

                const tx = await contract.requestMatching(petId);
                showStatus('Matching request sent, waiting for confirmation...', 'info');

                const receipt = await tx.wait();
                showStatus('Matching request confirmed, processing...', 'info');

                // Listen for matching result events
                contract.on('MatchFound', (requestId, petId, matchId, compatibility) => {
                    displayMatchResult(requestId, petId, matchId, compatibility);
                });

                contract.on('NoSuitableMatch', (requestId, petId) => {
                    showStatus('No suitable matching pet found', 'info');
                });

            } catch (error) {
                console.error('Matching request failed:', error);
                showStatus('Matching request failed: ' + error.message, 'error');
            } finally {
                showLoading('requestMatching', false);
            }
        }

        async function loadAvailablePets() {
            if (!contract) {
                showStatus('Please connect wallet first', 'error');
                return;
            }

            try {
                showLoading('loadAvailablePets', true);

                const availablePetIds = await contract.getAvailablePets();
                const availablePetsList = document.getElementById('availablePetsList');

                availablePetsList.innerHTML = '';

                if (availablePetIds.length === 0) {
                    availablePetsList.innerHTML = '<p>No available pets for breeding</p>';
                    return;
                }

                for (let i = 0; i < availablePetIds.length; i++) {
                    const petId = availablePetIds[i];
                    const petInfo = await contract.getPetInfo(petId);

                    // Skip own pets
                    if (petInfo.petOwner.toLowerCase() === userAccount.toLowerCase()) {
                        continue;
                    }

                    const petCard = createAvailablePetCard(petId, petInfo);
                    availablePetsList.appendChild(petCard);
                }

                showStatus(`Loaded ${availablePetIds.length} available pets for breeding`, 'success');

            } catch (error) {
                console.error('Loading available pets failed:', error);
                showStatus('Loading available pets failed: ' + error.message, 'error');
            } finally {
                showLoading('loadAvailablePets', false);
            }
        }

        async function toggleBreedingStatus(petId) {
            if (!contract) return;

            try {
                const tx = await contract.toggleBreedingStatus(petId);
                showStatus('Updating status...', 'info');

                await tx.wait();
                showStatus('Breeding status updated', 'success');

                // Reload pet list
                setTimeout(() => loadMyPets(), 1000);

            } catch (error) {
                console.error('Update breeding status failed:', error);
                showStatus('Update breeding status failed: ' + error.message, 'error');
            }
        }

        function createPetCard(petId, petInfo) {
            const card = document.createElement('div');
            card.className = 'pet-card';

            card.innerHTML = `
                <h3>${petInfo.name}</h3>
                <p><strong>ÂìÅÁßç:</strong> ${petInfo.breed}</p>
                <p><strong>Âπ¥ÈæÑ:</strong> ${petInfo.age} Â≤Å</p>
                <p><strong>ÈÖçÁßçÁä∂ÊÄÅ:</strong> ${petInfo.isAvailableForBreeding ? 'ÂèØÈÖçÁßç' : '‰∏çÂèØÈÖçÁßç'}</p>
                <p><strong>Ê≥®ÂÜåÊó∂Èó¥:</strong> ${new Date(petInfo.registrationTime * 1000).toLocaleDateString()}</p>
                <div class="pet-actions">
                    <button class="btn btn-warning" onclick="toggleBreedingStatus(${petId})">
                        ${petInfo.isAvailableForBreeding ? 'ËÆæ‰∏∫‰∏çÂèØÈÖçÁßç' : 'ËÆæ‰∏∫ÂèØÈÖçÁßç'}
                    </button>
                </div>
            `;

            return card;
        }

        function createAvailablePetCard(petId, petInfo) {
            const card = document.createElement('div');
            card.className = 'pet-card';

            card.innerHTML = `
                <h3>${petInfo.name}</h3>
                <p><strong>ÂìÅÁßç:</strong> ${petInfo.breed}</p>
                <p><strong>Âπ¥ÈæÑ:</strong> ${petInfo.age} Â≤Å</p>
                <p><strong>‰∏ª‰∫∫:</strong> ${petInfo.petOwner.substring(0, 6)}...${petInfo.petOwner.substring(38)}</p>
                <p><strong>Ê≥®ÂÜåÊó∂Èó¥:</strong> ${new Date(petInfo.registrationTime * 1000).toLocaleDateString()}</p>
            `;

            return card;
        }

        function displayMatchResult(requestId, petId, matchId, compatibility) {
            const matchingResults = document.getElementById('matchingResults');

            const resultDiv = document.createElement('div');
            resultDiv.className = 'match-result';

            resultDiv.innerHTML = `
                <h3>üéâ ÊâæÂà∞ÂåπÈÖç!</h3>
                <p><strong>ÂåπÈÖçÂÆ†Áâ©ID:</strong> ${matchId}</p>
                <div class="compatibility-score">${compatibility}%</div>
                <p>Áõ∏ÂÆπÊÄßËØÑÂàÜÔºåÊï∞ÂÄºË∂äÈ´ò‰ª£Ë°®Ë∂äÈÄÇÂêàÁπÅËÇ≤</p>
            `;

            matchingResults.appendChild(resultDiv);
        }

        function clearRegistrationForm() {
            document.getElementById('petName').value = '';
            document.getElementById('petBreed').value = '';
            document.getElementById('petAge').value = '';
            document.getElementById('marker1').value = '';
            document.getElementById('marker2').value = '';
            document.getElementById('marker3').value = '';
            document.getElementById('marker4').value = '';
            document.getElementById('healthRisk').value = '';
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;

            // 3ÁßíÂêéËá™Âä®Ê∏ÖÈô§ÊàêÂäüÊ∂àÊÅØ
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 3000);
            }
        }

        function showLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            if (loading) {
                button.disabled = true;
                button.innerHTML = '<div class="loading"></div> Processing...';
            } else {
                button.disabled = false;
                // Restore original button text
                switch(buttonId) {
                    case 'connectWallet':
                        button.innerHTML = 'Connect MetaMask Wallet';
                        break;
                    case 'registerPet':
                        button.innerHTML = 'Register Pet';
                        break;
                    case 'loadMyPets':
                        button.innerHTML = 'Load My Pets';
                        break;
                    case 'requestMatching':
                        button.innerHTML = 'Start Matching';
                        break;
                    case 'loadAvailablePets':
                        button.innerHTML = 'View Available Pets';
                        break;
                }
            }
        }

        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                // User disconnected wallet
                userAccount = null;
                contract = null;
                document.getElementById('walletInfo').classList.add('hidden');
                showStatus('Wallet disconnected', 'info');
            } else if (accounts[0] !== userAccount) {
                // User switched accounts
                userAccount = accounts[0];
                connectWallet();
            }
        }

        function handleChainChanged(chainId) {
            // Reload page when network changes
            window.location.reload();
        }

        // Generate random DNA marker values (for demo)
        function generateRandomDNA() {
            document.getElementById('marker1').value = Math.floor(Math.random() * 256);
            document.getElementById('marker2').value = Math.floor(Math.random() * 256);
            document.getElementById('marker3').value = Math.floor(Math.random() * 256);
            document.getElementById('marker4').value = Math.floor(Math.random() * 256);
            document.getElementById('healthRisk').value = Math.floor(Math.random() * 100); // Lower health risk
            showStatus('Random DNA markers generated', 'success');
        }

        // Add toggleBreedingStatus function to global scope
        window.toggleBreedingStatus = toggleBreedingStatus;
    </script>
</body>
</html>
